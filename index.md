# インデックス

B+Tree以外にもインデックスの種類はあるが、ここでは説明しない。

## 1.B+Treeインデックス

B+Treeは、名前の通りデータを木構造で保持するインデックスのこと。
バランスがとれており、インデックスをなんの修飾もなくインデックスを作成する場合は、このインデックスになる。

B+Treeインデックスのイメージは下記の通り。

![](./drawio/output/index.png)

B+Treeが優れている点は、たとえば次のような点である。

- ルートノードとリーフノードの距離が一定に保たれており、検索性能が安定している。
- 木構造の深さが3～4レベルほどで一定。
- データがソートされて保持されているため、検索コストが低い。

## 2.インデックスを有効活用するためには

B+Treeの長所は、汎用性の高さである。。
キー値の間で検索速度にばらつきが少なく、データ量増加に対して検索速度の劣化が緩やかで、
等号だけでなく不等号を使用した検索条件でも使用可能である。
しかし、インデックスもとにかく作ればよいものではなく、ポイントを考慮する必要がある。

### 2-1.カーディナリティと選択率

インデックスはテーブルの特定の列集合に対して作成するが、このときどのような列に対してインデックスを
作成すべきかの基準となるのが列のカーディナリティと選択率である。

| 項目 | 概要 |
| :--: | :-- |
| カーディナリティ | 列の値がどれだけばらついているか。 |
| 選択率 | 特定の列の値を指定したとき、母集合に対してどれだけ絞り込めるか。 |

#### 2-1-1.カーディナリティ

カーディナリティは、列の値がどれだけばらついているかを示す概念である。
最もカーディナリティが高いのは、すべての行に対して値が異なる一意キーの列で
最も低いのは、値が1種類しか存在しない列である。
複数列の場合も考え方は同様である。

複合キーインデックスを作成する場合、通常はカーディナリティが高い列を先頭にする。
なぜなら、複合キーインデックスの先頭キーから順に絞り込むためである。

#### 2-1-2.選択率

選択率は、特定の列の値を指定したとき、母集合に対してどれだけ絞り込めるかを示す概念である。
たとえば、100件のレコードをもつテーブルに対して、一意キーに「pkey = 1」のように等号で指定すれば、必ず1件に絞り込めるため、選択率は1%とになる。


