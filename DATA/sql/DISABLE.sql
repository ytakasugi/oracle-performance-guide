SET SERVEROUTPUT ON

DECLARE
  CURSOR CUR IS
    SELECT
      SYS_CONTEXT('USERENV', 'SESSION_USER')
      , C.TABLE_NAME
      , C.INDEX_NAME
      , CC.COLUMN_NAME
      , CC.POSITION
    FROM
      USER_CONSTRAINTS C
      , USER_CONS_COLUMNS CC
    WHERE
      C.OWNER = CC.OWNER
      AND C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME
      AND C.TABLE_NAME = CC.TABLE_NAME
      AND C.CONSTRAINT_TYPE IN ('P', 'C')
      AND C.TABLE_NAME LIKE 'SRC%'
      AND C.INDEX_NAME IS NOT NULL
    ORDER BY
      C.TABLE_NAME
      , C.INDEX_NAME
      , CC.POSITION
    ;

 V_STMT VARCHAR2(1000);

BEGIN
  --すべてのテーブルに対して
    V_STMT := 'TRUNCATE TABLE TMP_UNIQUE_INDEX';
    EXECUTE IMMEDIATE V_STMT;
    INSERT /*+ APPEND */ TMP_UNIQUE_INDEX
    SELECT
      ROWNUM AS ID
      , SYS_CONTEXT('USERENV', 'SESSION_USER')
      , C.TABLE_NAME
      , C.INDEX_NAME
      , CC.COLUMN_NAME
      , CC.POSITION
    FROM
      USER_CONSTRAINTS C
      , USER_CONS_COLUMNS CC
    WHERE
      C.OWNER = CC.OWNER
      AND C.CONSTRAINT_NAME = CC.CONSTRAINT_NAME
      AND C.TABLE_NAME = CC.TABLE_NAME
      AND C.CONSTRAINT_TYPE IN ('P', 'C')
      AND C.TABLE_NAME LIKE 'SRC%'
      AND C.INDEX_NAME IS NOT NULL
   ORDER BY
     C.TABLE_NAME
     , C.INDEX_NAME
     , CC.POSITION
   ;
END
;
/

--プライマリーキーを無効化。同時にユニークインデックスの削除
BEGIN
  FOR REC IN CUR LOOP
    DBMS_OUTPUT.PUT_LINE(V_STMT);
    V_STMT := 'ALTER TABLE ' || REC.TABLE_NAME || ' DISABLE CONSTRAINT' || REC.INDEX_NAME || ' CASCADE DROP INDEX';
    EXECUTE IMMEDIATE V_STMT;
  END LOOP;
END;
/

quit
